# 高并发系统的设计


## 单服务器高并发

### 进程和线程

#### 一、为什么使用多进程/线程？
两个方面：
+ I/O 方面：因为往往一个任务中间需要执行 I/O 操作，此时 CPU 空闲状态。为了提高 CPU 利用率，所以引入了并发机制。
+ 多核 CPU 方面：多核 CPU 的出现，使得任务之间可以并行处理。

##### 并发和并行
并发：提高 CPU利用率
并行：Amdal定律。

#### 二、进程/线程数是不是越多越好？
结论：在现代操作系统中，不是。以下从两个维度解释：
 
##### 历史观测数维度
进程数和 CPU 利用率呈现这样一个函数关系：刚开始，进程数增加，CPU 利用率随之提高；当进程数增加到一定峰值时，继续增加进程，CPU 利用率不升反降。如果继续增加进程，可能出现颠簸现象:即进程的实际执行都在等待磁盘的换入换出，而执行有效任务时间大大减少，CPU 利用率降低，系统吞吐量减小。因为这个现象，所以需要加载控制。

##### 技术理论维度
+ 首先是内存管理的需要：现代操作系统的实现，不会将一个进程所需要的内存一次性的加载出来，是根据访问频率分配一定的页框数，将暂时不需要的内存数据换出到磁盘，而提升内存利用率。缺页率

##### 上下文切换的开销

##### CPU 利用率
```
    CPU 利用率 = CPU 执行时间 / (CPU 执行时间 + IO 等待时间 + 上下文切换时间)
```

#### 三、如何提高系统吞吐量？

#### 进程模型分析

#### 线程模型分析
1. 地址空间

### I/O 性能

#### 阻塞和非阻塞

#### 多路 I/O 复用
多条连接复用一个阻塞的系统调用。

#### 分散/聚集 I/O

#### 同步 I/O 和 异步 I/O

#### Reactor 模型


### UDP 高并发

## 集群高并发
