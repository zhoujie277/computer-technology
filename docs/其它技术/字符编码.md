## 字符编码 
在计算机内部，所有信息最终都是一个二进制值，一个字节用八个二进制位表示，八个二进制位能组合 256 种状态。假设每种状态对应一个字符，那么，一个字节能就能表示 256 个字符。

### ASCII、Unicode 和 UTF-8

#### ACSII 码
上个世纪 60 年代，美国指定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定，这被称为 ASCII 码，一直沿用至今。

ASCII 码一共规定了 128 个字符的编码，比如空格 SPACE 是 32（00100000），大写的字母 A 是 65(01000001)。这 128 个符号，只占用了一个字节的后面 7 位，最前面的一位规定为 0。

由于 ASCII 码最初只是用来编码英文字母和特殊符号，因此在长度上，只设计用了一个字节表示。它不能满足国际通信编码的需要。

##### 为何产生乱码？
因为编码方式众多，字符编码方式和字符解码方式不一致，导致解析到乱码。

#### Unicode
Unicode 是一个很大的编码集合，现在的规模可以容纳 100 多万个符号，每个符号的编码都是唯一的。这是一种目前可以满足国际通信需要的符号编码方式。

##### Unicode 的问题
需要注意的是，Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。

这里有两个问题：
1. 如何才能区别 Unicode 和 ASCII ？计算机怎么知道三个字节表示一个符号，而不是分别表示三个符号呢？
2. 如果 Unicode 统一规定，每个符号用定长编码表示，比如每个符号用三个或者四个字节表示，那么每个英文字母前就必然有 2-3 个字节是 0，因为每个英文字母只需要一个字节就够了，这对于存储来说是极大的浪费，文本文件的大小会因此大出数倍。

以上两个问题造成的结果是：出现了 Unicode 的多种存储方式，也就是说有许多种不同的二进制格式，可以用来表示 Unicode

#### UTF-8
互联网的普及，强烈要求出现一种统一的编码方式。UTF-8 就是在互联网使用最广的一种互联网方式。其它实现方式还包括 UTF-16（字符用两个字节或四个字节表示）和 UTF-32（字符用四个字节表示），不过在互联网上基本不用。重点是：这里的关系是，UTF-8 是 Unicode 的实现方式之一。

UTF-8 最大的一个特点，就是它是一种变长的编码方式。它可以使 1-4 个字节表示一个符号，根据不同的符号而变化字节长度。

UTF-8 的编码规则很简单，只有二条：
1. 对于单字节的符号，字节的第一位设位 0，后面 7 位为这个符号的 Unicode 码，因此对于英文字母，UTF-8 编码和 ASCII 码是相同的。
2. 对于 n 字节的符号 (n > 1)，第一个字节的前 n 位都设为 1，第 n + 1 位设为 0，后面的字节前两位一律设为 10。剩下的没有提及二进制位，全部为这个符号的 Unicode 码。

下表总结了编码规则，字母 x 表示可用编码的位

| Unicode 符号范围 (十六进制)   | UTF-8 编码方式                |
| ------------------- | ----------------------------------- |
| 00000000 ~ 0000007F | 0xxxxxxx                            |
| 00000080 ~ 000007FF | 110xxxxx 10xxxxxx                   |
| 00000800 ~ 0000FFFF | 1110xxxx 10xxxxxx 10xxxxxx          |
| 00010000 ~ 0010FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

根据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是 0，则这个字节单独就是一个字符；如果第一位是 1，则连续有多少个 1，就表示当前字符占用多少个字节。

#### 大端字节序和小端字节序
大端字节序指的是：高字节存储在低地址，低字节存储在高地址。
小端字节序指的是：低字节存储在低地址，高字节存储在高地址。

##### 计算机如何知道某一个文件到底采用哪一种方式编码？
Unicode 规范定义，每一个文件的最前面分别加入一个表示编码顺序地字符，这个字符的名字就叫做“领宽度非换行空格”（zero width no-break space），用 FEFF 表示。这正好是两个字节，而且 FF 比 FE 大 1。

如果一个文本文件的头两个字节的是 FE FF，就表示该文件采用大端方式，如果头两个字节是 FF FE，就表示该文件采用小头方式。

比如：汉字”杰“对应的十六进制unicode字符表示为：0x6770。用文本编辑器编辑查看其编码方式，不难发现如下情况。
```
    // 地址从0开始，往后递增。
    unicode 小端存储为：FF FE 70 67
    unicode 大端存储为：FE FF 67 70
```

### 示例
[unicode 字符表](http://www.chi2ko.com/tool/CJK.htm) 

汉字 ”杰“，在unicode 字符集中用两个字节表示，十六进制为 0x6770，
```
其对应的小端存储的二进制表示为：
  
    01100111 01110000

在 unicode 符号范围内
00000800 ~ 0000FFFF 之内，所以对应的 UTF-8 编码为

    11100110 10011101 10110000 

所以，汉字“杰”在 UTF-8 编码之后转换为十六进制就是 

    E69DB0
```

### 扩展阅读
https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/